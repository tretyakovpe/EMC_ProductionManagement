@model IEnumerable<ProductionManagement.Models.Progress>

@{
    Layout = "_Progress";
}

<style>
    /* Внешний контейнер */
    .custom-progress-container {
        position: relative;
        display: inline-block;
        overflow: hidden;
        width: 100%;
        height: 80%;
        border-radius: 3px;
    }

    /* Первая (Бэклог) полоса */
    .backlog-stripe {
        background-color: red;
        height: 100%;
        z-index: 1;
    }

    /* Вторая (Запланировано) полоса */
    .planned-stripe {
        background-color: blue;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 2;
        text-align: end;
    }

    /* Третья (Выполнено) полоса */
    .done-stripe {
        border-radius: 3px;
        background-color: green;
        height: 80%;
        position: absolute;
        top: 10%;
        z-index: 3;
        text-align: end;
    }
</style>

<div class="container">
    @foreach (var item in Model)
    {
        // Проверяем значения на null и преобразуем в double
        var result = item.Result ?? 0;
        var planned = item.Planned ?? 1; // Избегаем деления на ноль

        // Производим расчёт и округляем
        var progress = Math.Round((double)result / planned * 100);

        <div class="row mb-3">
            <div class="col-3">
                <div>@item.Material</div>
                <div>@item.Description</div>
            </div>
            <div class="col align-content-center">
                <div class="custom-progress-container">
                    <div class="backlog-stripe" style="width: @(item.Backlog)px;"></div>
                    <div class="planned-stripe" style="left:@(item.Backlog)%; width: calc(100%-@(item.Backlog)%);">@(item.Planned)</div>
                    <div class="done-stripe" style="width: @progress%;">@(item.Result)</div>
                </div>
            </div>
        </div>
    }
</div>